\begin{figure}
\small

\renewcommand*{\arraystretch}{1.25}

\definecolor{new}{HTML}{F5EFE6}

\begin{gather*}
\begin{array}{@{}rccl@{}}
\text{Contexts} & \Gm, \Dl &\Coloneqq &
    \cdot \mid \Gm, A
    \\ 
\text{Substitutions} & \gm &\Coloneqq &
    \SubstEmp \mid \SubstWeak{n} \mid \SubstComp{\gm_1}{\gm_2} \mid \SubstExt{\gm}{t}
    \\
\text{Types} & A, B, T  &\Coloneqq &
    \cU \mid \cB \mid \bot \mid \top \mid \TyPi{A}{B} \mid \TySigma{A}{B} \mid \El{t} \mid \sub{T}{\gm} \mid
    \\
    &&&
\tikzmarkin[disable rounded corners=true,set fill color=new,set border color=new]{New2}(0.05,-0.15)(-0.10,0.30)
    \TyWSingle{\wsig} \mid \wsigproj{j}{1}{\wsig} \mid \wsigproj{j}{2}{\wsig} \mid
    \TyLkg{\lsig} \mid \TyTkg{\lsig} \mid \lsigprojT{\lsig} \mid \lsigproj{2}{\lsig} \mid \CaseSig{A}{B}{T}
\tikzmarkend{New2}
    \\
\text{Terms} & t, s, \lkg &\Coloneqq &
    \var{n} \mid \true \mid \false \mid \codety{T} \mid \sub{t}{\gm} \mid \lam{t} \mid \app{t} \mid \pair{t_1}{t_2} \mid \fst{t} \mid \snd{t} \mid
    \\
    &&&
\tikzmarkin[disable rounded corners=true,set fill color=new,set border color=new]{New3}(0.05,-0.15)(-0.10,0.30)
    \wsingle{\wsig} \mid \wcode{\wsig} \mid \wsup{\wsig}{t_1}{t_2} \mid \LkgEmp \mid \LkgAdd{\lkg}{t} \mid \inh{h}{\lkg} \mid
    \\
    &&&
    \lkgproj{1}{\lkg} \mid \lkgproj{2}{\lkg} \mid \lsigproj{s}{\lsig} \mid \Tkg{\lkg} \mid
    \Recproj{j}{\lkg} \mid \Wrec{\lkg}{t}
\tikzmarkend{New3}
    \\
\tikzmarkin[disable rounded corners=true,set fill color=new,set border color=new]{New1}(0.05,-0.15)(-0.10,0.30)
\text{W-type signatures} & \wsig & \Coloneqq &
    \WSigEmp \mid \WSigAdd{\wsig}{A}{B} \mid \sub{\wsig}{\gm}
\tikzmarkend{New1}
    \\
\tikzmarkin[disable rounded corners=true,set fill color=new,set border color=new]{New5}(0.05,-0.15)(-0.10,0.30)
\text{Linkage signatures} & \lsig & \Coloneqq &
    \LSigEmp \mid \LSigAdd{\lsig}{\seal}{T} \mid \lsigproj{1}{\lsig} \mid \RecSig{\wsig}{T} \mid \sub{\lsig}{\gm}
\tikzmarkend{New5}
    \\
\tikzmarkin[disable rounded corners=true,set fill color=new,set border color=new]{New4}(0.05,-0.15)(-0.10,0.30)
\text{Linkage transformers} & h & \Coloneqq &
    \InhId \mid \InhExt{h}{t} \mid \InhOv{h}{t} \mid \InhInh{h} \mid \InhNest{h}{h'}
\tikzmarkend{New4}
\end{array}
\end{gather*}

\begin{mathpar}
\judgebox{\goodCtx{\Gm}{i}}

\judgebox{\goodSub{\Gm}{\gm}{\Dl}}

\judgebox{\goodType{\Gm}{T}{}}

\judgebox{\goodTerm{\Gm}{t}{T}}

\judgebox{\goodWSig{\Gm}{\wsig}{n}}

\judgebox{\goodSig{\Gm}{\lsig}{n} }

\judgebox{\goodInh{\Gm}{h}{\lsig_1}{\lsig_2}}
\\

\Rule[name=sub/id]{
    \goodCtx{\Gm}{i}
}{
    \goodSub{\Gm}{\SubstWeak{0}}{\Gm}
}

\Rule[name=sub/weaken]{
    \goodSub{\Gm}{\SubstWeak{n}}{\Dl}
    \\
    \goodType{\Gm}{A}{}
}{
    \goodSub{\Gm, A}{\SubstWeak{n+1}}{\Dl}
}

\Rule[name=sub/ext]{
    \goodSub{\Gm}{\gm}{\Dl}
    \\
    \goodTerm{\Gm}{t}{\sub{A}{\gm}}
    \\
    \goodType{\Dl}{A}{}
}{
    \goodSub{\Gm}{\SubstExt{\gm}{t}}{\Dl,A}
}

\Rule[name=ty/sub]{
    \goodType{\Dl}{T}{j}
    \\
    \goodSub{\Gm}{\gm}{\Dl}
}{
    \goodType{\Gm}{T[\gm]}{j}
}

\Rule[name=tm/sub]{
    \goodTerm{\Dl}{t}{T}
    \\
    \goodSub{\Gm}{\gm}{\Dl}
}{
    \goodTerm{\Gm}{\sub{t}{\gm}}{\sub{T}{\gm}}
}

\Rule[name=tm/var]{
    \goodCtx{\Gm, A_n, ..., A_1, A_0}{}
}{
    \goodSub{\Gm, A_n, ..., A_1, A_0}{\var{n}}{\sub{A_n}{\SubstWeak{n+1}}}
}

\Rule[name=tm/singleton]{
    \goodWSig{\Gm}{\wsig}{n}
}{
    \goodTerm{\Gm}{\wsingle{\wsig}}{\TyWSingle{\wsig}}
}

\Rule[name=tm/w]{
    \goodWSig{\Gm}{\wsig}{n}
}{
    \goodTerm{\Gm}{\wcode{\wsig}}{\cU}
}

\Rule[name=tm/wrec]{
    \goodTerm{\Gm}{\lkg}{\TyLkg{\RecSig{\wsig}{T}}}
    \\
    \goodTerm{\Gm}{t}{\El{\wcode{\wsig}}}
}{
    \goodTerm{\Gm}{\Wrec{\lkg}{t}}{T}
}

\end{mathpar}

\caption{Selected syntax and typing rules of \TT}
\label{fig:typing-selected}
\end{figure}